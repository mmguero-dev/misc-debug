### Setup

* install [my work-in-progress analyzer](https://github.com/mmguero-dev/icsnpp-synchrophasor)
    - `zkg install --skiptests --force https://github.com/mmguero-dev/icsnpp-synchrophasor`
* grab the `C37.118_1PMU_UDP_minimal.pcap` and `C37.118_1PMU_UDP_minimal.stream` from this directory

### List of files and directories

* `C37.118_1PMU_UDP_minimal.pcap`
    - PCAP containing minimal communication

* `C37.118_1PMU_UDP_minimal.stream`
    - Raw bytes containing UDP "stream" 0 from `C37.118_1PMU_UDP_minimal.pcap`
    - Generated via:
```bash
tshark -r /debug/C37.118_1PMU_UDP_minimal.pcap -e "udp.payload" -Tfields -Y udp.stream==0 | \
    sed "s/://g" | \
    xxd -r -p > \
    /debug/C37.118_1PMU_UDP_minimal.stream
```

* `spicy_dump_output.json`
    - output of:
```bash
spicy-dump -J -p SYNCHROPHASOR::Frames /icsnpp-synchrophasor/analyzer/synchrophasor.spicy \
    < /debug/C37.118_1PMU_UDP_minimal.stream \
    > /debug/spicy_dump_output.json
```

* `spicy_dump_output.txt`
    - output of:
```bash
spicy-dump -P -p SYNCHROPHASOR::Frames /icsnpp-synchrophasor/analyzer/synchrophasor.spicy \
    < /debug/C37.118_1PMU_UDP_minimal.stream \
    > /debug/spicy_dump_output.txt
```

* `logs/`
    - directory containing Zeek logs generated by `zeek -C -r /debug/C37.118_1PMU_UDP_minimal.pcap local misc/dump-events` after `zkg` installation of analyzer

* `zeek_dump_events.txt`
    - output of `zeek -C -r /debug/C37.118_1PMU_UDP_minimal.pcap local misc/dump-events` after `zkg` installation of analyzer

* `zeek_hlto_hilti_debug.txt`
    - following some of the steps from [7.8 Debugging](https://docs.zeek.org/projects/spicy/en/latest/zeek.html#debugging)
        + compiled with `spicyz -d -D zeek synchrophasor.spicy synchrophasor.evt -o synchrophasor.hlto`
        + this text file is output of `HILTI_DEBUG=zeek zeek -B dpd -Cr /debug/C37.118_1PMU_UDP_minimal.pcap synchrophasor.hlto`
        + not sure why the log files weren't generated when I ran this command but I don't think it matters, as the `event SYNCHROPHASOR::DataFrame` line illustrates the issue

### Issue

The `spicy-dump` output does not match the Zeek output as illustrated here:

#### Expected (correct)

Notice the `DATA_FRAME` structure from the `spicy-dump` output (I've replaced some stuff here with `⋯` to make it more readable, but the output in the `spicy_dump_output.json` and `spicy_dump_output.txt` files is complete): Note that the `initialized` values are `True` (a value I set when the units are parsed "correctly" and match what they're expected to match), and that `numPMUActual` and `numPMUExpected` are both `1`. The `pmuFound` field indicates that I was able to find the index into the vector of previous frames that was needed to decode this data frame. This data all looks correct.

```
SYNCHROPHASOR::Frame {
  parseError: False
  header: SYNCHROPHASOR::FrameHeader {
    timeStamp: 2008-08-01T16:18:11.000000000Z
    sync: SYNCHROPHASOR::SyncField {
      frameType: DATA_FRAME
      version: 1
    }
    frameSize: 48
    dataStreamId: 60
    fracSec: SYNCHROPHASOR::FracSec {
      fracSec: 0.58
      data: (fracSecRaw: 580000, qualityIndicator: 0, leapSecPending: 0, leapSecOccurred: 0, leapSecDirection: 0, _: 0)
    }
  }
  _payload: ⋯
  chk: 6812
  DATA_FRAME: SYNCHROPHASOR::DataFrame {
    initialized: True
    cfgFrame: SYNCHROPHASOR::ConfigFrame { ⋯ }
    cfgFound: True
    numPMUExpected: 1
    numPMUActual: 1
    data: [
      SYNCHROPHASOR::PMUData {
        initialized: True
        pmuFound: True
        pmuIdx: 0
        pmuCfg: SYNCHROPHASOR::PMUConfig { ⋯ }
        stat: (⋯)
        phasors: [ ⋯ ]
        freq: SYNCHROPHASOR::FrequencyDeviation { ⋯ }
        dfreq: SYNCHROPHASOR::ROCOF { ⋯ }
        digital: [ ⋯ ]
      }
    ]
  }
}
```

#### Actual (incorrect)

The first thing I noticed was the value in the `synchrophasor_data.log` file didn't look right:

```
#separator \x09
#set_separator  ,
#empty_field    (empty)
#unset_field    -
#path   synchrophasor_data
#open   2023-03-07-14-36-03
#fields ts  uid id.orig_h   id.orig_p   id.resp_h   id.resp_p   proto   frame_type  pmu_count_expected  pmu_count_actual
#types  time    string  addr    port    addr    port    string  string  count   count
1218023578.629213   CbroLJ1aUIO6OyD1a9  192.168.0.10    4712    192.168.0.60    4713    udp Data    0   16
#close  2023-03-07-14-36-03
```

What tipped me off here was that the `pmu_count_expected` and `pmu_count_actual` values are `0` and `16`, respectively, when I expected them to both be `1`. I checked the `main.zeek` file's [event](https://github.com/mmguero-dev/icsnpp-synchrophasor/blob/4c9269bd342ced5eb8c27831c6cea4e6e8d2952a/analyzer/main.zeek#L485-L496) and [record](https://github.com/mmguero-dev/icsnpp-synchrophasor/blob/4c9269bd342ced5eb8c27831c6cea4e6e8d2952a/analyzer/main.zeek#L98-L107) for this log, and compared it with the [`.evt` file](https://github.com/mmguero-dev/icsnpp-synchrophasor/blob/4c9269bd342ced5eb8c27831c6cea4e6e8d2952a/analyzer/synchrophasor.evt#L51-L62) and the [originating unit](https://github.com/mmguero-dev/icsnpp-synchrophasor/blob/4c9269bd342ced5eb8c27831c6cea4e6e8d2952a/analyzer/synchrophasor.spicy#L336-L396) and from what I can tell they seem to match.

Looking at the corresponding line in `zeek_hlto_hilti_debug.txt`, I see things don't look right either:

```
[zeek] [SPICY_SYNCHROPHASOR_UDP/3/resp] -> event SYNCHROPHASOR::DataFrame($conn, $is_orig, FrameTypeCode::DATA_FRAME, 2008-08-01T16:18:11.000000000Z, 48, 6812, 1, 60, false, 0, 16)
```

The `initialized` value is `false` and the `pmu_count_expected` and `pmu_count_actual` values are `0` and `16`.

The `zeek_dump_events.txt` which is just another way of looking at the same thing also looks wrong:

```
1218023578.629213 SYNCHROPHASOR::DataFrame
                  [0] c: connection      = [⋯]
                  [1] is_orig: bool      = F
                  [2] frameType: SYNCHROPHASOR::FrameTypeCode = SYNCHROPHASOR::FrameTypeCode_DATA_FRAME
                  [3] timeStamp: time    = 1217607491.0
                  [4] frameSize: count   = 48
                  [5] chk: count         = 6812
                  [6] version: count     = 1
                  [7] dataStreamId: count = 60
                  [8] initialized: bool  = F
                  [9] numPMUExpected: count = 0
                  [10] numPMUActual: count = 16
```

### `print` statement Output

With Zeek and the PCAP vs with spicy-driver (line-by-line). I put a `print self;` statement in the `%on done` section of the `Frame`.

#### commands

* `zeek -Cr /debug/C37.118_1PMU_UDP_minimal.pcap synchrophasor.hlto main.zeek Spicy::enable_print=T`
* `cat /debug/C37.118_1PMU_UDP_minimal.stream | spicy-driver -d -p SYNCHROPHASOR::Frames synchrophasor.spicy`

#### output

* "send cfg-2" command frame
    - `zeek` and `spicy-driver` output match exactly:

```
[$parseError=False, $header=[$timeStamp=2008-08-06T11:52:58.000000000Z, $sync=[$frameType=FrameTypeCode::COMMAND_FRAME, $version=1], $frameSize=18, $dataStreamId=60, $fracSec=[$fracSec=0, $data=(9448978, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x05", $chk=5770, $DATA_FRAME=(not set), $HEADER_FRAME=(not set), $COMMAND_FRAME=[$cmd=5, $extframe=[]], $CONFIG_FRAME=(not set)]
```

* cfg-2 frame
    - `zeek` and `spicy-driver` output match exactly:

```
[$parseError=False, $header=[$timeStamp=2008-08-01T16:18:11.000000000Z, $sync=[$frameType=FrameTypeCode::CONFIG_2_FRAME, $version=1], $frameSize=374, $dataStreamId=60, $fracSec=[$fracSec=0, $data=(520000, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x0fB@\x00\x01PMU1            \x00=\x00\x07\x00\x03\x00\x00\x00\x01VA              VB              VC              Dig Channel 1   Dig Channel 2   Dig Channel 3   Dig Channel 4   Dig Channel 5   Dig Channel 6   Dig Channel 7   Dig Channel 8   Dig Channel 9   Dig Channel 10  Dig Channel 11  Dig Channel 12  Dig Channel 13  Dig Channel 14  Dig Channel 15  Dig Channel 16  \x00\x00\x04\xc4\x00\x00\x04\xc4\x00\x00\x04\xc4\x00\x00\x00\x00\x00\x01\x00\x01\x002", $chk=33234, $DATA_FRAME=(not set), $HEADER_FRAME=(not set), $COMMAND_FRAME=(not set), $CONFIG_FRAME=[$initialized=True, $cfgNum=False, $timeBase=1000000, $contIdx=0, $numPMUActual=1, $allStationNames=["PMU1            "], $allPhasorNames=["VA              ", "VB              ", "VC              "], $allAnalogNames=[], $allDigitalNames=["Dig Channel 1   ", "Dig Channel 2   ", "Dig Channel 3   ", "Dig Channel 4   ", "Dig Channel 5   ", "Dig Channel 6   ", "Dig Channel 7   ", "Dig Channel 8   ", "Dig Channel 9   ", "Dig Channel 10  ", "Dig Channel 11  ", "Dig Channel 12  ", "Dig Channel 13  ", "Dig Channel 14  ", "Dig Channel 15  ", "Dig Channel 16  "], $numPMUExpected=1, $pmuCfgs=[[$frameType=FrameTypeCode::CONFIG_2_FRAME, $initialized=True, $pmuIdx=0, $svcClass="", $dgnmrMult=16, $stationName="PMU1            ", $dataSourceId=61, $globalPMUID=(not set), $format=(1, 1, 1, 0, 0), $phnmr=3, $annmr=0, $dgnmr=1, $phnam=["VA              ", "VB              ", "VC              "], $annam=[], $dgnam=["Dig Channel 1   ", "Dig Channel 2   ", "Dig Channel 3   ", "Dig Channel 4   ", "Dig Channel 5   ", "Dig Channel 6   ", "Dig Channel 7   ", "Dig Channel 8   ", "Dig Channel 9   ", "Dig Channel 10  ", "Dig Channel 11  ", "Dig Channel 12  ", "Dig Channel 13  ", "Dig Channel 14  ", "Dig Channel 15  ", "Dig Channel 16  "], $phunit=[[$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)], [$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)], [$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)]], $anunit=[], $digunit=[[$normalStatusMask=0, $validInputsMask=0]], $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=1, $cfgcnt=1]], $dataRate=50]]
```

* "data transmission on" command frame
    - `zeek` and `spicy-driver` output do not match exactly, but they are very close
    - the part that seems to be different is the `$fracSec` was not calculated, which implies my `map` of frames based on `dataStreamId` maybe didn't get looked up correctly in the `FracSec` `on %done` hook

`zeek` output (bad):

```
[$parseError=False, $header=[$timeStamp=2008-08-06T11:52:58.000000000Z, $sync=[$frameType=FrameTypeCode::COMMAND_FRAME, $version=1], $frameSize=18, $dataStreamId=60, $fracSec=[$fracSec=0, $data=(10235393, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x02", $chk=63349, $DATA_FRAME=(not set), $HEADER_FRAME=(not set), $COMMAND_FRAME=[$cmd=2, $extframe=[]], $CONFIG_FRAME=(not set)]
```

`spicy-driver` output (good):

```
[$parseError=False, $header=[$timeStamp=2008-08-06T11:53:08.235393000Z, $sync=[$frameType=FrameTypeCode::COMMAND_FRAME, $version=1], $frameSize=18, $dataStreamId=60, $fracSec=[$fracSec=10.2354, $data=(10235393, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x02", $chk=63349, $DATA_FRAME=(not set), $HEADER_FRAME=(not set), $COMMAND_FRAME=[$cmd=2, $extframe=[]], $CONFIG_FRAME=(not set)]
```

* extra `print` statement in `DataFrame` `on %init`
    - `zeek` and `spicy-driver` output match exactly: `60`

* data frame
    - `zeek` and `spicy-driver` output do not match
    - this also implies the lookup into the `streamSourceIdConfigFrameMap` in the `PMUData` unit's `stat` field hook was not successful

`zeek` output (bad):

```
[$parseError=False, $header=[$timeStamp=2008-08-01T16:18:11.000000000Z, $sync=[$frameType=FrameTypeCode::DATA_FRAME, $version=1], $frameSize=48, $dataStreamId=60, $fracSec=[$fracSec=0, $data=(580000, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x00B\xc8'\xb9\xbf\xc8\x9e\xc2B\xc7\xe4y@'\xad'B\xc8\x05\x11?\x06\xbe\xb0\x00\x00\x00\x00\x00\x00", $chk=6812, $DATA_FRAME=[$initialized=False, $cfgFrame=[$initialized=False, $cfgNum=False, $timeBase=0, $contIdx=0, $numPMUActual=0, $allStationNames=[], $allPhasorNames=[], $allAnalogNames=[], $allDigitalNames=[], $numPMUExpected=(not set), $pmuCfgs=(not set), $dataRate=(not set)], $cfgFound=False, $numPMUExpected=0, $numPMUActual=16, $data=[[$initialized=False, $pmuFound=False, $pmuIdx=0, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(0, 0, 0, 0, 0, 0, 0, 0, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=1, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(8, 0, 3, 1, 0, 0, 0, 0, 1), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=2, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(9, 3, 6, 1, 1, 0, 0, 1, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=3, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(8, 0, 7, 1, 1, 1, 1, 1, 2), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=4, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(2, 0, 3, 1, 1, 1, 1, 0, 2), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=5, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(7, 0, 3, 1, 0, 0, 0, 0, 1), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=6, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(9, 3, 1, 0, 1, 0, 0, 1, 3), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=7, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(7, 2, 0, 0, 0, 0, 0, 0, 1), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=8, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(7, 2, 4, 0, 1, 1, 0, 1, 2), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=9, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(8, 0, 3, 1, 0, 0, 0, 0, 1), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=10, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(1, 1, 4, 0, 1, 0, 0, 0, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=11, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(6, 0, 4, 1, 1, 1, 1, 1, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=12, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(0, 3, 2, 1, 1, 1, 1, 1, 2), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=13, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(0, 0, 0, 0, 0, 0, 0, 0, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=14, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(0, 0, 0, 0, 0, 0, 0, 0, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)], [$initialized=False, $pmuFound=False, $pmuIdx=15, $pmuCfg=[$frameType=FrameTypeCode::Undef, $initialized=False, $pmuIdx=0, $svcClass="", $dgnmrMult=0, $stationName=(not set), $dataSourceId=(not set), $globalPMUID=(not set), $format=(not set), $phnmr=(not set), $annmr=(not set), $dgnmr=(not set), $phnam=(not set), $annam=(not set), $dgnam=(not set), $phunit=(not set), $anunit=(not set), $digunit=(not set), $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=(not set), $cfgcnt=(not set)], $stat=(0, 0, 0, 0, 0, 0, 0, 0, 0), $phasors=(not set), $freq=(not set), $dfreq=(not set), $analog=(not set), $digital=(not set)]]], $HEADER_FRAME=(not set), $COMMAND_FRAME=(not set), $CONFIG_FRAME=(not set)]
```

`spicy-driver` output (good):

```
[$parseError=False, $header=[$timeStamp=2008-08-01T16:18:11.580000000Z, $sync=[$frameType=FrameTypeCode::DATA_FRAME, $version=1], $frameSize=48, $dataStreamId=60, $fracSec=[$fracSec=0.58, $data=(580000, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x00B\xc8'\xb9\xbf\xc8\x9e\xc2B\xc7\xe4y@'\xad'B\xc8\x05\x11?\x06\xbe\xb0\x00\x00\x00\x00\x00\x00", $chk=6812, $DATA_FRAME=[$initialized=True, $cfgFrame=[$initialized=True, $cfgNum=False, $timeBase=1000000, $contIdx=0, $numPMUActual=1, $allStationNames=["PMU1            "], $allPhasorNames=["VA              ", "VB              ", "VC              "], $allAnalogNames=[], $allDigitalNames=["Dig Channel 1   ", "Dig Channel 2   ", "Dig Channel 3   ", "Dig Channel 4   ", "Dig Channel 5   ", "Dig Channel 6   ", "Dig Channel 7   ", "Dig Channel 8   ", "Dig Channel 9   ", "Dig Channel 10  ", "Dig Channel 11  ", "Dig Channel 12  ", "Dig Channel 13  ", "Dig Channel 14  ", "Dig Channel 15  ", "Dig Channel 16  "], $numPMUExpected=1, $pmuCfgs=[[$frameType=FrameTypeCode::CONFIG_2_FRAME, $initialized=True, $pmuIdx=0, $svcClass="", $dgnmrMult=16, $stationName="PMU1            ", $dataSourceId=61, $globalPMUID=(not set), $format=(1, 1, 1, 0, 0), $phnmr=3, $annmr=0, $dgnmr=1, $phnam=["VA              ", "VB              ", "VC              "], $annam=[], $dgnam=["Dig Channel 1   ", "Dig Channel 2   ", "Dig Channel 3   ", "Dig Channel 4   ", "Dig Channel 5   ", "Dig Channel 6   ", "Dig Channel 7   ", "Dig Channel 8   ", "Dig Channel 9   ", "Dig Channel 10  ", "Dig Channel 11  ", "Dig Channel 12  ", "Dig Channel 13  ", "Dig Channel 14  ", "Dig Channel 15  ", "Dig Channel 16  "], $phunit=[[$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)], [$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)], [$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)]], $anunit=[], $digunit=[[$normalStatusMask=0, $validInputsMask=0]], $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=1, $cfgcnt=1]], $dataRate=50], $cfgFound=True, $numPMUExpected=1, $numPMUActual=1, $data=[[$initialized=True, $pmuFound=True, $pmuIdx=0, $pmuCfg=[$frameType=FrameTypeCode::CONFIG_2_FRAME, $initialized=True, $pmuIdx=0, $svcClass="", $dgnmrMult=16, $stationName="PMU1            ", $dataSourceId=61, $globalPMUID=(not set), $format=(1, 1, 1, 0, 0), $phnmr=3, $annmr=0, $dgnmr=1, $phnam=["VA              ", "VB              ", "VC              "], $annam=[], $dgnam=["Dig Channel 1   ", "Dig Channel 2   ", "Dig Channel 3   ", "Dig Channel 4   ", "Dig Channel 5   ", "Dig Channel 6   ", "Dig Channel 7   ", "Dig Channel 8   ", "Dig Channel 9   ", "Dig Channel 10  ", "Dig Channel 11  ", "Dig Channel 12  ", "Dig Channel 13  ", "Dig Channel 14  ", "Dig Channel 15  ", "Dig Channel 16  "], $phunit=[[$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)], [$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)], [$format=(196, 4), $flags=(not set), $typeInd=(not set), $userDef=(not set), $scaleFactor=(not set), $angleAdj=(not set)]], $anunit=[], $digunit=[[$normalStatusMask=0, $validInputsMask=0]], $pmuLat=(not set), $pmuLon=(not set), $pmuElev=(not set), $window=(not set), $groupDelay=(not set), $fnom=1, $cfgcnt=1], $stat=(0, 0, 0, 0, 0, 0, 0, 0, 0), $phasors=[[$rectangular=(not set), $polar=[$realValInt=(not set), $realValFloat=100.078, $imaginaryValInt=(not set), $imaginaryValFloat=-1.56734]], [$rectangular=(not set), $polar=[$realValInt=(not set), $realValFloat=99.9462, $imaginaryValInt=(not set), $imaginaryValFloat=2.61994]], [$rectangular=(not set), $polar=[$realValInt=(not set), $realValFloat=100.01, $imaginaryValInt=(not set), $imaginaryValFloat=0.526347]]], $freq=[$freqDevMhzInt=0, $freqDevMhzFloat=(not set)], $dfreq=[$rocofInt=0, $rocofFloat=(not set)], $analog=(not set), $digital=[0]]]], $HEADER_FRAME=(not set), $COMMAND_FRAME=(not set), $CONFIG_FRAME=(not set)]
```


* "data transmission on" command frame
    - `zeek` and `spicy-driver` output do not match exactly, but they are very close
    - the part that seems to be different is the `$fracSec` was not calculated, which implies my `map` of frames based on `dataStreamId` maybe didn't get looked up correctly in the `FracSec` `on %done` hook

`zeek` output (bad):

```
[$parseError=False, $header=[$timeStamp=2008-08-06T11:53:05.000000000Z, $sync=[$frameType=FrameTypeCode::COMMAND_FRAME, $version=1], $frameSize=18, $dataStreamId=60, $fracSec=[$fracSec=0, $data=(12328716, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x01", $chk=50444, $DATA_FRAME=(not set), $HEADER_FRAME=(not set), $COMMAND_FRAME=[$cmd=1, $extframe=[]], $CONFIG_FRAME=(not set)]
```

`spicy-driver` output (good):

```
[$parseError=False, $header=[$timeStamp=2008-08-06T11:53:17.328716000Z, $sync=[$frameType=FrameTypeCode::COMMAND_FRAME, $version=1], $frameSize=18, $dataStreamId=60, $fracSec=[$fracSec=12.3287, $data=(12328716, 0, 0, 0, 0, 0)]], $_payload=b"\x00\x01", $chk=50444, $DATA_FRAME=(not set), $HEADER_FRAME=(not set), $COMMAND_FRAME=[$cmd=1, $extframe=[]], $CONFIG_FRAME=(not set)]
```

### Other Observations

1. `logs/notice.log`
    - `CaptureLoss::Too_Little_Traffic  Only observed 0 TCP ACKs and was expecting at least 1`
        + What's up with this? Is this just a normal occurance for a PCAP with no TCP traffic, or for some reason is Zeek thinking it should expect to see some TCP traffic? `logs/telemetry.log` lists 0 TCP sessions and 1 UDP session so maybe this isn't an issue.

### Hypotheses

* I've got something defined incorrectly in the event? I'm not sure how, though, as I have [several traces](https://github.com/mmguero-dev/icsnpp-synchrophasor/tree/main/tests/traces) that do this exact thing many times over TCP and they don't have the issue.
* Something happens different timings-wise between TCP and UDP streams that I don't understand?
* I've done something wrong registering or confirming the protocol for UDP vs TCP? I do see the `spicy_synchrophasor_udp` for the protocol in conn.log so that doesn't seem likely to me.
* ???